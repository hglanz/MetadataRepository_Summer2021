---
title: "Test"
author: "Sucheen Sundaram"
date: "6/21/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(rvest)
library(Frost2021Package)
```

```{r}
test_vest <- read_html("https://datahub.io/higorspinto/car-sales-world-annual")
description <- test_vest %>% html_nodes(".readable-width") %>% html_text()
description %>%
  pluck(2) %>%
  str_remove_all("\n")
```

```{r}
read_html("https://www.kaggle.com/kaggle/meta-kaggle") %>%
  html_nodes(".bpBCZF") %>%
  html_text()

url <- "https://datahub.io/core/natural-gas"
  text <- url %>%
    read_html() %>%
    html_nodes(".no-left-padding th:nth-child(6) , .no-left-padding th:nth-child(5) , .no-left-padding th:nth-child(4) , .no-left-padding th:nth-child(3) , .no-left-padding th:nth-child(2) , .no-left-padding th:nth-child(1)") %>%
    html_text()
df <- data.frame(matrix(ncol = length(text), nrow = 0))
colnames(df) <- text

data <- url %>%
    read_html() %>%
    html_nodes(".format-list~ .col-xs-2+ .col-xs-2 , .format-list , .no-left-padding .col-xs-1")  %>%
    html_text()
data <- data %>%
  str_remove_all("\n")
data[1:4]
data <- rbind(df, text) %>%
  rbind(data) %>%
  rowid_to_column() %>%
  filter(rowid > 1)

url %>%
  read_html() %>%
  html_nodes("h1") %>%
  html_text()

data <- data[,2:length(names(data))]
```

```{r}
url <- "https://datadryad.org/stash/dataset/doi:10.6078/D1M08W"
cols <- scrape_rvest(url, ".c-sidebox__heading , .o-heading__level2 , .o-heading__level1")
data <- scrape_rvest(url, ".c-locations__data , .o-heading__level2+ p , .t-landing__text-wall p , .o-metadata__author , #show_license p , .o-metrics__metric , .c-file-group , .c-file-group__summary")
df <- data.frame(matrix(ncol = length(cols), nrow = 0))
df <- rbind(df, data)
names(df) <- c("one", "two", "three", "four", "five", "six", "seven", "eight", "nine")
df <- df %>%
  mutate(Authors = paste(one, two, three, sep = "; "))
df <- df[!(names(df) %in% c("one", "two", "three"))]
file_info_columns <- scrape_rvest(url, "#sidebar a")
file_info_data <- scrape_rvest(url, ".c-file-group__list div")
file_info <- data.frame(filename = file_info_columns, sizeMB = file_info_data)
numbers <- parse_number(file_info$sizeMB)
count <- 1
for(i in file_info$sizeMB) {
  if("k" %in% i) { # if reported in kilobytes
    numbers[count] <- numbers[count]/1000
  }else if(!("MB" %in% i)) { # if reported in bytes
    numbers[count] <- numbers[count]/1000000
  }
  count <- count+1
}
file_info$sizeMB <- numbers
df$eight <- file_info %>%
  nest(data = everything())
names(df) <- cols[2:8]
names(df) <- c("Citation", "Abstract", "Funding", "Location", "Data", "Date", "Authors")
```

```{r}
dataframe <- scrape_dryad("https://datadryad.org/stash/dataset/doi:10.6078/D14Q14")
pieces <- map_int(names(dataframe), ~str_split(dataframe[.x], " ") %>% pluck(1) %>% length())
dataframe[pieces != 2]
authors <- dataframe$Citation %>%
  str_split(" [(]") %>%
  pluck(1)
authors[1]
```

```{r}
url <- "https://dataverse.harvard.edu/dataset.xhtml?persistentId=doi:10.7910/DVN/GPRRND"
name <- scrape_rvest(url, "#title")
  cols <- scrape_rvest(url, "th , #metrics-heading")
  data <- scrape_rvest(url, ".metrics-count-block , td")
  df <- data.frame(matrix(ncol = length(cols), nrow = 0))
  df <- rbind(df, data)
  df$Citation <- scrape_rvest(url, ".citation-select")
  names(df) <- cols
  names(df)[6] <- "function"
  names(df)[5] <- "File Data"
  file_info_cols <- c("Name", "Downloads", "Variables", "Observations")
  file_info_names <- scrape_rvest(url, ".fileNameOriginal a")
  file_info_names <- file_info_names[file_info_names != ""]
  file_info <- data.frame(matrix(ncol = length(file_info_cols), nrow = length(file_info_names)))
  names(file_info) <- file_info_cols
  file_info <- cbind(file_info, file_info_names)
  file_info$Name <- file_info$file_info_names
  file_info <- file_info[, names(file_info) != "file_info_names"]
  downloads <- scrape_rvest(url, ".visible-lg-inline")
  variables <- scrape_rvest(url, ".unf-block span:nth-child(1)")
  observations <- scrape_rvest(url, ".unf-block span:nth-child(2)")
  if(!identical(downloads, character(0))) {
    while(length(downloads) != nrow(file_info)) {
      downloads <- append(downloads, 0)
    }
    file_info$Downloads <- parse_number(downloads)
  }else{
    file_info$Downloads <- NA
  }
  if(!identical(variables, character(0))) {
    while(length(variables) != nrow(file_info)) {
      variables <- append(variables, 0)
    }
    file_info$Variables <- parse_number(variables)
  }else{
    file_info$Variables <- NA
  }
  if(!identical(observations, character(0))) {
    while(length(observations) != nrow(file_info)) {
      observations <- append(observations, 0)
    }
    file_info$Observations <- parse_number(observations)
  }else{
    file_info$Observations <- NA
  }
  file_info <- nest(file_info, data = everything())
  df$`File Data` <- file_info
  df

sh <- scrape_harvard(url)
scrape_rvest(url, ".unf-block span:nth-child(1)")
sh$`File Data` %>% unnest()
df$`File Data` %>% unnest()
```

```{r}
url <- "https://data.cdc.gov/Vaccinations/COVID-19-Vaccine-Distribution-Allocations-by-Juris/w9zu-fywh"
cols <- scrape_rvest(url, ".entry-description div")
df <- data.frame(matrix(ncol = length(cols), nrow = 0))
data <- scrape_rvest(url, ".dd")
url %>%
  read_html(url) %>%
  rvest::html_nodes(xpath = "//*[contains(concat( \" \", @class, \" \" ), concat( \" \", \"title\", \" \" ))]") %>%
  html_text()
```

```{r}
url <- "https://data.ca.gov/dataset/california-state-fleet"
cols <- scrape_rvest(url, "dt , .module-heading , tr:nth-child(9) .dataset-label , tr:nth-child(10) .dataset-label , tr:nth-child(2) .dataset-label , tr:nth-child(1) .dataset-label , tr:nth-child(3) .dataset-label , tr:nth-child(5) .dataset-label , thead th:nth-child(1) , .tags h3")
data <- scrape_rvest(url, ".automatic-local-datetime , .license span , .nav-item a , .module-shallow .heading , dd , tr:nth-child(5) .dataset-details , tr:nth-child(1) .dataset-details , .main-responsive-panel h1 , th+ th , .well")
df <- data.frame(matrix(ncol = length(cols), nrow = 0))
df <- rbind(df, data)
names(df) <- cols
df
```

